<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Belajar Cerdas (ABC)</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind Config untuk Animasi -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'blob': 'blob 7s infinite',
                        'bounce-slow': 'bounce 3s infinite',
                        'confetti-fall': 'confettiFall linear infinite',
                        'slide-up-fade': 'slideUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'scale-in': 'scaleIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'slide-down': 'slideDown 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'fade-in': 'fadeIn 0.4s ease-out forwards',
                        'pop': 'pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        confettiFall: {
                            '0%': { transform: 'translateY(0) rotate(0deg)', opacity: '1' },
                            '100%': { transform: 'translateY(100vh) rotate(720deg)', opacity: '0' },
                        },
                        slideUpFade: {
                            'from': { opacity: '0', transform: 'translateY(20px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' },
                        },
                        scaleIn: {
                            'from': { opacity: '0', transform: 'scale(0.95)' },
                            'to': { opacity: '1', transform: 'scale(1)' },
                        },
                        slideDown: {
                            'from': { opacity: '0', transform: 'translateY(-20px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeIn: {
                            'from': { opacity: '0' },
                            'to': { opacity: '1' },
                        },
                        pop: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)', opacity: '1' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, useMemo } = React;

        // --- ICONS (Manual Definition to replace lucide-react dependency in HTML) ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );

        const Volume2 = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><path d="M15.54 8.46a5 5 0 0 1 0 7.07" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14" /></IconBase>;
        const VolumeX = (props) => <IconBase {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><line x1="23" y1="9" x2="17" y2="15" /><line x1="17" y1="9" x2="23" y2="15" /></IconBase>;
        const ChevronRight = (props) => <IconBase {...props}><polyline points="9 18 15 12 9 6" /></IconBase>;
        const Home = (props) => <IconBase {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></IconBase>;
        const BookOpen = (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></IconBase>;
        const Calculator = (props) => <IconBase {...props}><rect width="16" height="20" x="4" y="2" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></IconBase>;
        const RefreshCcw = (props) => <IconBase {...props}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" /><path d="M16 16h5v5" /></IconBase>;
        const Check = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12" /></IconBase>;
        const Sparkles = (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /><path d="M5 3v4" /><path d="M9 3v4" /><path d="M3 5h4" /><path d="M3 9h4" /></IconBase>;
        const XCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="m15 9-6 6" /><path d="m9 9 6 6" /></IconBase>;
        const Globe = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><line x1="2" x2="22" y1="12" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" /></IconBase>;
        const CheckCircle2 = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="m9 12 2 2 4-4" /></IconBase>;
        const Moon = (props) => <IconBase {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></IconBase>;
        const Sun = (props) => <IconBase {...props}><circle cx="12" cy="12" r="4" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" /></IconBase>;
        const Award = (props) => <IconBase {...props}><circle cx="12" cy="8" r="6" /><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11" /></IconBase>;
        const Zap = (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></IconBase>;
        const Star = (props) => <IconBase {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></IconBase>;

        // --- DATA STATIS ---
        const INDO_DB = {
            1: [
                { word: "API", emoji: "ðŸ”¥" }, { word: "TAS", emoji: "ðŸŽ’" }, { word: "JUS", emoji: "ðŸ¥¤" },
                { word: "BOLA", emoji: "âš½" }, { word: "BUKU", emoji: "ðŸ“š" }, { word: "MATA", emoji: "ðŸ‘€" },
                { word: "GIGI", emoji: "ðŸ¦·" }, { word: "SUSU", emoji: "ðŸ¥›" }, { word: "ROTI", emoji: "ðŸž" },
                { word: "IBU", emoji: "ðŸ‘©" },
            ],
            2: [
                { word: "MEJA", emoji: "ðŸª‘" }, { word: "BAJU", emoji: "ðŸ‘•" }, { word: "RUMAH", emoji: "ðŸ " },
                { word: "MOBIL", emoji: "ðŸš—" }, { word: "LAMPU", emoji: "ðŸ’¡" }, { word: "PINTU", emoji: "ðŸšª" },
                { word: "HUJAN", emoji: "ðŸŒ§ï¸" }, { word: "BULAN", emoji: "ðŸŒ™" }, { word: "KASUR", emoji: "ðŸ›ï¸" },
                { word: "PAGAR", emoji: "ðŸš§" }, { word: "POHON", emoji: "ðŸŒ³" }, { word: "KUNCI", emoji: "ðŸ”‘" },
            ],
            3: [
                { word: "SEKOLAH", emoji: "ðŸ«" }, { word: "SEPATU", emoji: "ðŸ‘Ÿ" }, { word: "KELINCI", emoji: "ðŸ‡" },
                { word: "PESAWAT", emoji: "âœˆï¸" }, { word: "BINTANG", emoji: "â­" }, { word: "MATAHARI", emoji: "â˜€ï¸" },
                { word: "KOMPUTER", emoji: "ðŸ’»" }, { word: "TELEVISI", emoji: "ðŸ“º" }, { word: "JENDELA", emoji: "ðŸªŸ" },
                { word: "KELUARGA", emoji: "ðŸ‘¨â€ðŸ‘©â€ðŸ‘§" }, { word: "PELANGI", emoji: "ðŸŒˆ" }, { word: "BENDERA", emoji: "ðŸ‡®ðŸ‡©" },
                { word: "SEPEDA", emoji: "ðŸš²" }, { word: "BONEKA", emoji: "ðŸ§¸" }, { word: "GITAR", emoji: "ðŸŽ¸" },
            ]
        };

        const ENGLISH_DB = {
            1: [
                { word: "CAT", emoji: "ðŸ±" }, { word: "DOG", emoji: "ðŸ¶" }, { word: "SUN", emoji: "â˜€ï¸" },
                { word: "CAR", emoji: "ðŸš—" }, { word: "BUS", emoji: "ðŸšŒ" }, { word: "PEN", emoji: "ðŸ–Šï¸" },
                { word: "CUP", emoji: "â˜•" }, { word: "HAT", emoji: "ðŸ§¢" }, { word: "BAG", emoji: "ðŸŽ’" },
                { word: "EGG", emoji: "ðŸ¥š" },
            ],
            2: [
                { word: "BIRD", emoji: "ðŸ¦" }, { word: "FISH", emoji: "ðŸŸ" }, { word: "DUCK", emoji: "ðŸ¦†" },
                { word: "LION", emoji: "ðŸ¦" }, { word: "FROG", emoji: "ðŸ¸" }, { word: "BOOK", emoji: "ðŸ“š" },
                { word: "MILK", emoji: "ðŸ¥›" }, { word: "CAKE", emoji: "ðŸ°" }, { word: "TREE", emoji: "ðŸŒ³" },
                { word: "STAR", emoji: "â­" }, { word: "MOON", emoji: "ðŸŒ™" }, { word: "DOOR", emoji: "ðŸšª" },
            ],
            3: [
                { word: "APPLE", emoji: "ðŸŽ" }, { word: "TIGER", emoji: "ðŸ¯" }, { word: "ZEBRA", emoji: "ðŸ¦“" },
                { word: "HOUSE", emoji: "ðŸ " }, { word: "MOUSE", emoji: "ðŸ­" }, { word: "SNAKE", emoji: "ðŸ" },
                { word: "TRAIN", emoji: "ðŸš‚" }, { word: "PLANE", emoji: "âœˆï¸" }, { word: "TABLE", emoji: "ðŸª‘" },
                { word: "ROBOT", emoji: "ðŸ¤–" }, { word: "FLOWER", emoji: "ðŸŒ»" }, { word: "GRAPES", emoji: "ðŸ‡" },
                { word: "ORANGE", emoji: "ðŸŠ" }, { word: "BANANA", emoji: "ðŸŒ" }, { word: "PENCIL", emoji: "âœï¸" },
            ]
        };

        // --- CONFETTI ---
        const Confetti = React.memo(() => {
            const particles = useMemo(() => Array.from({ length: 60 }).map((_, i) => ({
                id: i,
                left: Math.random() * 100 + '%',
                animationDelay: Math.random() * 2 + 's',
                animationDuration: (Math.random() * 2 + 2) + 's',
                backgroundColor: ['#6366f1', '#8b5cf6', '#ec4899', '#f43f5e', '#10b981', '#fbbf24'][Math.floor(Math.random() * 6)]
            })), []);

            return (
                <div className="fixed inset-0 pointer-events-none z-50 overflow-hidden">
                    {particles.map((p) => (
                        <div 
                        key={p.id} 
                        className="absolute top-[-20px] w-3 h-6 rounded-sm opacity-90 animate-confetti-fall shadow-sm" 
                        style={{ 
                            left: p.left, 
                            backgroundColor: p.backgroundColor, 
                            animationDelay: p.animationDelay, 
                            animationDuration: p.animationDuration
                        }}
                        />
                    ))}
                </div>
            );
        });

        // --- SOUND ENGINE ---
        const useSFX = () => {
            const [enabled, setEnabled] = useState(true);
            const audioCtxRef = useRef(null);

            useEffect(() => {
                return () => { if (audioCtxRef.current) audioCtxRef.current.close(); };
            }, []);

            const playTone = useCallback((type) => {
                if (!enabled) return;
                try {
                    if (!audioCtxRef.current) audioCtxRef.current = new (window.AudioContext || window.webkitAudioContext)();
                    const ctx = audioCtxRef.current;
                    if (ctx.state === 'suspended') ctx.resume();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain); gain.connect(ctx.destination);
                    const now = ctx.currentTime;

                    const sounds = {
                        tap: () => { osc.frequency.setValueAtTime(800, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1); osc.start(now); osc.stop(now + 0.1); },
                        delete: () => { osc.frequency.setValueAtTime(300, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1); osc.start(now); osc.stop(now + 0.1); },
                        correct: () => { osc.type = 'sine'; osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(1200, now + 0.2); gain.gain.setValueAtTime(0.2, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4); osc.start(now); osc.stop(now + 0.4); },
                        wrong: () => { osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.3); gain.gain.setValueAtTime(0.2, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3); osc.start(now); osc.stop(now + 0.3); },
                        win: () => { [523, 659, 784, 1046].forEach((f, i) => { const o = ctx.createOscillator(); const g = ctx.createGain(); o.connect(g); g.connect(ctx.destination); o.frequency.value = f; g.gain.setValueAtTime(0.1, now + i*0.1); g.gain.linearRampToValueAtTime(0, now + i*0.1 + 0.4); o.start(now + i*0.1); o.stop(now + i*0.1 + 0.4); }); },
                        lose: () => { [400, 300, 200].forEach((f, i) => { const o = ctx.createOscillator(); const g = ctx.createGain(); o.connect(g); g.connect(ctx.destination); o.type='triangle'; o.frequency.value = f; g.gain.setValueAtTime(0.1, now + i*0.2); g.gain.linearRampToValueAtTime(0, now + i*0.2 + 0.3); o.start(now + i*0.2); o.stop(now + i*0.2 + 0.3); }); }
                    };
                    if(sounds[type]) sounds[type]();
                } catch (e) { console.error(e); }
            }, [enabled]);

            return { playTone, enabled, setEnabled };
        };

        // --- SHARED UI COMPONENTS ---
        const Card = ({ children, className = "", delay = 0 }) => (
            <div 
                className={`bg-white/80 dark:bg-slate-900/60 backdrop-blur-xl border border-white/20 dark:border-slate-700/50 shadow-xl rounded-[2rem] overflow-hidden ${className}`}
                style={{ animationDelay: `${delay}ms` }}
            >
                {children}
            </div>
        );

        const Button = React.memo(({ children, onClick, variant = 'primary', className = '', disabled = false, style = {} }) => {
            const base = "relative overflow-hidden rounded-2xl font-bold tracking-wide transition-all duration-200 active:scale-90 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2";
            const variants = {
                primary: "bg-gradient-to-br from-indigo-500 to-violet-600 hover:from-indigo-400 hover:to-violet-500 text-white shadow-lg shadow-indigo-500/30",
                secondary: "bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 shadow-sm",
                danger: "bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-rose-900/30 border border-transparent hover:border-rose-200 dark:hover:border-rose-800",
                action: "bg-indigo-600 text-white shadow-indigo-200 dark:shadow-none hover:bg-indigo-500" 
            };
            return (
                <button onClick={onClick} disabled={disabled} style={style} className={`${base} ${variants[variant]} ${className}`}>
                {children}
                </button>
            );
        });

        // Unified button for Grid layouts
        const GridButton = React.memo(({ onClick, children, variant = "default", disabled = false, className = "", style={}, vanishOnDisabled = true }) => {
            const styles = variant === "action" 
                ? "bg-indigo-600 text-white shadow-lg shadow-indigo-200/50 dark:shadow-none hover:bg-indigo-500 border-transparent active:bg-indigo-700" 
                : variant === "danger"
                ? "bg-rose-50 dark:bg-rose-900/20 text-rose-500 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-rose-900/40 border-transparent active:bg-rose-200"
                : "bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700 border-slate-200 dark:border-slate-700 border-b-4 active:border-b-0 active:translate-y-1 active:border-t-4 active:border-transparent";
            
            const disabledStyles = vanishOnDisabled 
                ? 'opacity-0 scale-50 pointer-events-none' 
                : 'opacity-50 cursor-not-allowed active:scale-100';

            return (
                <button 
                onClick={onClick}
                disabled={disabled}
                style={style}
                className={`h-16 w-full rounded-2xl text-2xl font-bold transition-all duration-100 flex items-center justify-center border ${styles} ${disabled ? disabledStyles : 'active:scale-95'} ${className}`}
                >
                {children}
                </button>
            );
        });

        // --- NEW COMPONENT: ABC LOGO ---
        const ABCLogo = () => (
            <div className="flex flex-col items-center select-none cursor-default hover:scale-105 transition-transform duration-300">
                <div className="flex gap-2 mb-1.5">
                <div className="w-11 h-11 rounded-xl bg-rose-500 text-white flex items-center justify-center text-2xl font-black shadow-md border-b-4 border-rose-700 transform -rotate-6 hover:rotate-0 transition-all duration-300">
                    A
                </div>
                <div className="w-11 h-11 rounded-xl bg-indigo-500 text-white flex items-center justify-center text-2xl font-black shadow-md border-b-4 border-indigo-700 transform hover:rotate-0 -translate-y-1.5 transition-all duration-300">
                    B
                </div>
                <div className="w-11 h-11 rounded-xl bg-emerald-500 text-white flex items-center justify-center text-2xl font-black shadow-md border-b-4 border-emerald-700 transform rotate-6 hover:rotate-0 transition-all duration-300">
                    C
                </div>
                </div>
                <span className="text-[10px] font-extrabold text-slate-400 dark:text-slate-500 tracking-[0.2em] uppercase">Aplikasi Belajar Cerdas</span>
            </div>
        );

        // Unified Level Selection Menu
        const LevelMenu = ({ title, levels, onSelect, onBack, colorTheme = "indigo" }) => (
            <Card className="w-full max-w-md p-6 animate-slide-up-fade">
                <h2 className="text-2xl font-black text-center mb-8 text-slate-800 dark:text-white tracking-tight animate-fade-in">{title}</h2>
                <div className="space-y-3">
                {levels.map((l, idx) => (
                    <button 
                    key={l.id} 
                    onClick={() => onSelect(l.id)} 
                    style={{ animationDelay: `${idx * 100}ms` }}
                    className={`w-full p-4 rounded-2xl bg-slate-50 dark:bg-slate-800/50 hover:bg-${colorTheme}-50 dark:hover:bg-${colorTheme}-900/20 border border-slate-200 dark:border-slate-700 hover:border-${colorTheme}-200 dark:hover:border-${colorTheme}-500/50 transition-all group flex items-center justify-between opacity-0 animate-slide-up-fade hover:scale-[1.02] active:scale-[0.98]`}
                    >
                    <div className="flex items-center gap-4">
                        <div className={`w-12 h-12 rounded-xl bg-white dark:bg-slate-800 shadow-sm flex items-center justify-center font-bold text-${colorTheme}-600 dark:text-${colorTheme}-400 text-xl group-hover:rotate-12 transition-transform duration-300`}>{l.id}</div>
                        <div className="text-left">
                        <div className="font-bold text-slate-700 dark:text-slate-200 text-lg">Level {l.id}</div>
                        <div className="text-xs text-slate-400 font-medium">{l.desc}</div>
                        </div>
                    </div>
                    <div className={`w-10 h-10 rounded-full flex items-center justify-center bg-white dark:bg-slate-800 text-slate-300 group-hover:text-${colorTheme}-500 transition-colors group-hover:translate-x-1 duration-300`}>
                        <ChevronRight size={24} strokeWidth={2.5} />
                    </div>
                    </button>
                ))}
                </div>
                <Button variant="secondary" onClick={onBack} className="w-full mt-8 py-4 text-base opacity-0 animate-slide-up-fade" style={{ animationDelay: '400ms' }}>Kembali ke Menu</Button>
            </Card>
        );

        // Unified Result Screen
        const ResultCard = ({ score, total, isPass, onRetry, onHome }) => (
            <Card className="w-full max-w-md p-8 text-center animate-scale-in relative overflow-hidden">
                {isPass && <Confetti />}
                <div className="w-28 h-28 mx-auto bg-gradient-to-br from-yellow-100 to-orange-100 dark:from-yellow-900/30 dark:to-orange-900/30 rounded-full flex items-center justify-center mb-6 shadow-inner ring-4 ring-white dark:ring-slate-800 z-10 relative animate-bounce-slow">
                {isPass ? <Award size={56} className="text-yellow-500 drop-shadow-sm" /> : <Zap size={56} className="text-slate-400" />}
                </div>
                <h2 className="text-5xl font-black text-slate-800 dark:text-white mb-2 tracking-tight z-10 relative">{Math.round((score / total) * 100)}%</h2>
                <p className="text-slate-500 dark:text-slate-400 mb-8 font-medium z-10 relative">{isPass ? "Luar Biasa! Kamu Hebat!" : "Jangan menyerah, coba lagi!"}</p>
                
                <div className="flex gap-4 mb-8 z-10 relative">
                <div className="flex-1 bg-green-50 dark:bg-green-900/20 p-4 rounded-3xl border border-green-100 dark:border-green-800/50 opacity-0 animate-slide-up-fade" style={{ animationDelay: '200ms' }}>
                    <div className="text-3xl font-black text-green-600 dark:text-green-400 mb-1">{score}</div>
                    <div className="text-xs font-bold text-green-600/60 dark:text-green-400/60 uppercase tracking-wider">Benar</div>
                </div>
                <div className="flex-1 bg-rose-50 dark:bg-rose-900/20 p-4 rounded-3xl border border-rose-100 dark:border-rose-800/50 opacity-0 animate-slide-up-fade" style={{ animationDelay: '300ms' }}>
                    <div className="text-3xl font-black text-rose-600 dark:text-rose-400 mb-1">{total - score}</div>
                    <div className="text-xs font-bold text-rose-600/60 dark:text-rose-400/60 uppercase tracking-wider">Salah</div>
                </div>
                </div>
                
                <div className="space-y-3 z-10 relative">
                <Button onClick={onRetry} variant="primary" className="w-full py-4 text-lg shadow-xl shadow-indigo-500/20 opacity-0 animate-slide-up-fade" style={{ animationDelay: '400ms' }}>Main Lagi</Button>
                <Button onClick={onHome} variant="secondary" className="w-full py-4 text-base border-transparent bg-slate-100 dark:bg-slate-800 opacity-0 animate-slide-up-fade" style={{ animationDelay: '500ms' }}>Menu Utama</Button>
                </div>
            </Card>
        );

        // --- MODULE: MATH ---
        function MathQuizModule({ playTone, onBack }) {
            const [phase, setPhase] = useState('menu'); 
            const [level, setLevel] = useState(1);
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [input, setInput] = useState('');
            const [feedback, setFeedback] = useState(null);

            const CONFIG = useMemo(() => ({ 1: { count: 5, max: 10 }, 2: { count: 10, max: 20 }, 3: { count: 15, max: 50 } }), []);

            const startQuiz = useCallback((lvl) => {
                const cfg = CONFIG[lvl];
                const newQs = [];
                const seen = new Set(); // To track unique questions
                
                let attempts = 0;
                // Generate until count reached or max attempts (safety)
                while (newQs.length < cfg.count && attempts < 1000) {
                attempts++;
                const isAdd = Math.random() > 0.5;
                let n1, n2, op, ans;
                
                if (isAdd) {
                    n1 = Math.floor(Math.random() * (cfg.max + 1));
                    n2 = Math.floor(Math.random() * (cfg.max - n1 + 1));
                    op = '+'; ans = n1 + n2;
                } else {
                    n1 = Math.floor(Math.random() * (cfg.max + 1));
                    n2 = Math.floor(Math.random() * (n1 + 1));
                    op = '-'; ans = n1 - n2;
                }
                
                const signature = `${n1}${op}${n2}`;
                if (!seen.has(signature)) {
                    seen.add(signature);
                    newQs.push({ n1, n2, op, ans });
                }
                }
                
                setLevel(lvl); setQuestions(newQs); setCurrentIndex(0); setScore(0); setInput(''); setPhase('playing'); playTone('tap');
            }, [CONFIG, playTone]);

            const handleNumClick = useCallback((n) => { 
                if (!feedback && input.length < 3) { playTone('tap'); setInput(prev => prev + n); } 
            }, [feedback, input.length, playTone]);

            const checkAnswer = useCallback(() => {
                if (input === '') return;
                const q = questions[currentIndex];
                const isCorrect = parseInt(input) === q.ans;
                setFeedback(isCorrect ? 'correct' : 'wrong');
                playTone(isCorrect ? 'correct' : 'wrong');
                if (isCorrect) setScore(s => s + 1);

                setTimeout(() => {
                setFeedback(null); setInput('');
                if (currentIndex < questions.length - 1) setCurrentIndex(c => c + 1);
                else {
                    setPhase('result');
                    playTone(Math.round(((isCorrect ? score + 1 : score) / questions.length) * 100) > 80 ? 'win' : 'lose');
                }
                }, 1000);
            }, [input, questions, currentIndex, playTone, score]);

            if (phase === 'menu') return (
                <LevelMenu 
                title="Pilih Level Matematika"
                levels={[1, 2, 3].map(l => ({ id: l, desc: `Angka 0 - ${CONFIG[l].max}` }))}
                onSelect={startQuiz}
                onBack={onBack}
                colorTheme="indigo"
                />
            );

            if (phase === 'result') return (
                <ResultCard 
                score={score} 
                total={questions.length} 
                isPass={Math.round((score / questions.length) * 100) > 80}
                onRetry={() => setPhase('menu')}
                onHome={onBack}
                />
            );

            const q = questions[currentIndex];
            return (
                <div className="w-full max-w-md space-y-6">
                <div className="flex justify-between items-center px-4 animate-slide-down">
                    <div className="flex items-center gap-2 text-sm font-bold text-slate-500 dark:text-slate-400 bg-white/50 dark:bg-slate-800/50 px-4 py-2 rounded-full backdrop-blur-sm border border-white/20 shadow-sm">
                    <Star size={14} className="text-yellow-500 fill-yellow-500"/> <span>Level {level}</span>
                    </div>
                    <div className="flex items-center gap-2 text-sm font-bold text-slate-500 dark:text-slate-400 bg-white/50 dark:bg-slate-800/50 px-4 py-2 rounded-full backdrop-blur-sm border border-white/20 shadow-sm">
                    <span>{currentIndex + 1} / {questions.length}</span>
                    </div>
                </div>

                <div key={currentIndex} className="animate-scale-in">
                    <Card className="p-8 relative min-h-[240px] flex items-center justify-center shadow-2xl shadow-indigo-500/10">
                    {feedback && (
                        <div className="absolute inset-0 z-10 flex items-center justify-center bg-white/95 dark:bg-slate-900/95 backdrop-blur-md animate-fade-in">
                        {feedback === 'correct' 
                            ? <div className="flex flex-col items-center text-green-500 animate-pop"><CheckCircle2 size={64} className="mb-3"/><span className="font-black text-2xl tracking-tight">BENAR!</span></div>
                            : <div className="flex flex-col items-center text-rose-500 animate-pop"><XCircle size={64} className="mb-3"/><span className="font-bold text-lg text-slate-500">Jawabannya:</span><span className="font-black text-4xl mt-1">{q.ans}</span></div>
                        }
                        </div>
                    )}
                    <div className="flex items-center justify-center gap-3 sm:gap-6 text-6xl font-black text-slate-800 dark:text-white">
                        <span>{q.n1}</span>
                        <span className="text-indigo-500">{q.op}</span>
                        <span>{q.n2}</span>
                        <span className="text-slate-300 dark:text-slate-600">=</span>
                        <span className={`min-w-[80px] text-center border-b-4 transition-all duration-300 ${input ? 'text-indigo-600 border-indigo-500 dark:text-indigo-400 scale-110' : 'text-slate-300 border-slate-200 dark:border-slate-700'}`}>
                        {input || '?'}
                        </span>
                    </div>
                    </Card>
                </div>

                <div className="grid grid-cols-3 gap-3">
                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((n, i) => (
                    <GridButton 
                        key={n} 
                        onClick={() => handleNumClick(n)}
                        className="opacity-0 animate-pop"
                        style={{ animationDelay: `${i * 50}ms`, animationFillMode: 'both' }}
                    >
                        {n}
                    </GridButton>
                    ))}
                    <GridButton 
                    onClick={() => { playTone('delete'); setInput(''); }} 
                    variant="danger" 
                    className="opacity-0 animate-pop"
                    style={{ animationDelay: '450ms', animationFillMode: 'both' }}
                    vanishOnDisabled={false}
                    >
                    <RefreshCcw size={24} strokeWidth={2.5} />
                    </GridButton>
                    <GridButton 
                    onClick={() => handleNumClick(0)}
                    className="opacity-0 animate-pop"
                    style={{ animationDelay: '500ms', animationFillMode: 'both' }}
                    >
                    0
                    </GridButton>
                    <GridButton 
                    onClick={checkAnswer} 
                    variant="action" 
                    className="opacity-0 animate-pop"
                    style={{ animationDelay: '550ms', animationFillMode: 'both' }}
                    vanishOnDisabled={false}
                    >
                    <Check size={28} strokeWidth={3} />
                    </GridButton>
                </div>
                </div>
            );
        }

        // --- MODULE: READING ---
        function ReadingQuizModule({ playTone, onBack, mode }) {
            const [phase, setPhase] = useState('menu');
            const [level, setLevel] = useState(1);
            const [questions, setQuestions] = useState([]);
            const [curr, setCurr] = useState(0);
            const [score, setScore] = useState(0);
            const [slots, setSlots] = useState([]);
            const [pool, setPool] = useState([]);
            const [feedback, setFeedback] = useState(null);

            const DB = useMemo(() => mode === 'en' ? ENGLISH_DB : INDO_DB, [mode]);
            const CONFIG = useMemo(() => ({ 1: { count: 5 }, 2: { count: 10 }, 3: { count: 15 } }), []);

            const loadQuestion = useCallback((data) => {
                const chars = data.word.split('');
                setSlots(Array(chars.length).fill(null));
                setPool(chars.map((c, i) => ({ id: i, char: c, used: false })).sort(() => Math.random() - 0.5));
                setFeedback(null);
            }, []);

            const startQuiz = useCallback((lvl) => {
                let src = [...DB[lvl]];
                src.sort(() => Math.random() - 0.5);
                const count = Math.min(CONFIG[lvl].count, src.length);
                const shuffled = src.slice(0, count);

                setLevel(lvl); setQuestions(shuffled); setCurr(0); setScore(0); setPhase('playing'); playTone('tap'); loadQuestion(shuffled[0]);
            }, [DB, CONFIG, playTone, loadQuestion]);

            const handleCharClick = useCallback((item) => {
                if (feedback) return;
                const emptyIdx = slots.indexOf(null);
                if (emptyIdx === -1) return;
                playTone('tap');
                const newSlots = [...slots]; newSlots[emptyIdx] = item; setSlots(newSlots);
                setPool(pool.map(p => p.id === item.id ? { ...p, used: true } : p));
            }, [feedback, slots, pool, playTone]);

            const handleReset = () => {
                playTone('delete'); 
                setSlots(Array(questions[curr].word.length).fill(null)); 
                setPool(pool.map(p => ({...p, used:false}))); 
            };

            const checkAnswer = useCallback(() => {
                if (slots.includes(null)) return; 

                const userWord = slots.map(s => s?.char).join('');
                const correctWord = questions[curr].word;
                const isCorrect = userWord === correctWord;

                setFeedback(isCorrect ? 'correct' : 'wrong'); 
                playTone(isCorrect ? 'correct' : 'wrong');

                if(isCorrect) setScore(s => s+1);

                setTimeout(() => {
                    if (curr < questions.length - 1) {
                        const nextQ = questions[curr + 1];
                        setCurr(c => c + 1);
                        const chars = nextQ.word.split('');
                        setSlots(Array(chars.length).fill(null));
                        setPool(chars.map((c, i) => ({ id: i, char: c, used: false })).sort(() => Math.random() - 0.5));
                        setFeedback(null);
                    } else {
                        setPhase('result');
                        playTone(Math.round(((isCorrect ? score + 1 : score) / questions.length) * 100) > 80 ? 'win' : 'lose');
                    }
                }, 1200);
            }, [slots, questions, curr, score, playTone]);

            if (phase === 'menu') return (
                <LevelMenu 
                title={mode === 'en' ? "Select Level" : "Pilih Level Membaca"}
                levels={[1, 2, 3].map(l => ({ id: l, desc: mode === 'en' ? `${CONFIG[l].count} Words` : `${CONFIG[l].count} Kata` }))}
                onSelect={startQuiz}
                onBack={onBack}
                colorTheme={mode === 'en' ? 'violet' : 'emerald'}
                />
            );

            if (phase === 'result') return (
                <ResultCard 
                score={score} 
                total={questions.length} 
                isPass={Math.round((score / questions.length) * 100) > 80}
                onRetry={() => setPhase('menu')}
                onHome={onBack}
                />
            );

            const q = questions[curr];
            return (
                <div className="w-full max-w-md space-y-6">
                <div className="flex justify-between items-center px-4 animate-slide-down">
                    <div className="flex items-center gap-2 text-sm font-bold text-slate-500 dark:text-slate-400 bg-white/50 dark:bg-slate-800/50 px-4 py-2 rounded-full backdrop-blur-sm border border-white/20 shadow-sm">
                    <Star size={14} className="text-yellow-500 fill-yellow-500"/> <span>Level {level}</span>
                    </div>
                    <div className="flex items-center gap-2 text-sm font-bold text-slate-500 dark:text-slate-400 bg-white/50 dark:bg-slate-800/50 px-4 py-2 rounded-full backdrop-blur-sm border border-white/20 shadow-sm">
                    <span>{curr + 1} / {questions.length}</span>
                    </div>
                </div>

                <div key={curr} className="animate-scale-in">
                    <Card className="p-8 relative min-h-[240px] flex flex-col items-center justify-center gap-6 shadow-2xl shadow-emerald-500/10">
                    {feedback && (
                        <div className="absolute inset-0 z-10 flex items-center justify-center bg-white/95 dark:bg-slate-900/95 backdrop-blur-md rounded-3xl animate-fade-in">
                        {feedback === 'correct' 
                            ? <div className="flex flex-col items-center text-green-500 animate-pop"><CheckCircle2 size={64} className="mb-3"/><span className="font-black text-2xl tracking-tight">BENAR!</span></div>
                            : <div className="flex flex-col items-center text-rose-500 animate-pop"><XCircle size={64} className="mb-3"/><span className="font-bold text-lg text-slate-500">Kata yang benar:</span><span className="font-black text-3xl mt-1 tracking-widest uppercase">{q.word}</span></div>
                        }
                        </div>
                    )}
                    <div className="text-8xl animate-bounce-slow filter drop-shadow-xl">{q.emoji}</div>
                    <div className="flex gap-2">
                        {slots.map((s, i) => (
                        <div key={i} className={`w-12 h-14 rounded-xl flex items-center justify-center text-2xl font-bold border-b-4 transition-all duration-300 ${s ? 'bg-indigo-100 border-indigo-300 text-indigo-700 dark:bg-indigo-900/40 dark:border-indigo-800 dark:text-indigo-300 animate-pop' : 'bg-slate-50 border-slate-200 dark:bg-slate-800 dark:border-slate-700'}`}>
                            {s?.char}
                        </div>
                        ))}
                    </div>
                    </Card>
                </div>

                <div className="grid grid-cols-5 gap-2">
                    {pool.map((l, i) => (
                    <GridButton 
                        key={l.id} 
                        disabled={l.used || feedback}
                        onClick={() => handleCharClick(l)}
                        className="aspect-square text-xl opacity-0 animate-pop"
                        style={{ animationDelay: `${i * 50}ms`, animationFillMode: 'both' }}
                        vanishOnDisabled={true}
                    >
                        {l.char}
                    </GridButton>
                    ))}
                </div>
                <div className="flex gap-3 mt-4 opacity-0 animate-slide-up-fade" style={{ animationDelay: `${pool.length * 50 + 100}ms` }}>
                    <GridButton onClick={handleReset} variant="danger" className="flex-1" vanishOnDisabled={false}>
                        <RefreshCcw size={24} strokeWidth={2.5}/>
                    </GridButton>
                    <GridButton onClick={checkAnswer} variant="action" className="flex-1" disabled={slots.includes(null)} vanishOnDisabled={false}>
                        <Check size={28} strokeWidth={3} />
                    </GridButton>
                </div>
                </div>
            );
        }

        // --- APP ROOT ---
        function App() {
            const [view, setView] = useState('home');
            const [isDark, setIsDark] = useState(false);
            const { playTone, enabled, setEnabled } = useSFX();

            return (
                <div className={isDark ? 'dark' : ''}>
                <div className="min-h-screen bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 font-sans selection:bg-indigo-200 dark:selection:bg-indigo-900/50 flex flex-col items-center overflow-hidden transition-colors duration-500 relative">
                    
                    {/* Abstract Background Blobs - Unified for all themes */}
                    <div className="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
                    <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-indigo-200/40 dark:bg-indigo-900/20 rounded-full blur-3xl animate-blob"/>
                    <div className="absolute top-[20%] right-[-10%] w-[40%] h-[40%] bg-purple-200/40 dark:bg-purple-900/20 rounded-full blur-3xl animate-blob animation-delay-2000"/>
                    <div className="absolute bottom-[-10%] left-[20%] w-[60%] h-[60%] bg-blue-100/40 dark:bg-slate-800/30 rounded-full blur-3xl animate-blob animation-delay-4000"/>
                    </div>

                    {/* Header - REDESIGNED */}
                    <header className="w-full max-w-xl flex justify-between items-center p-6 relative z-10 animate-slide-down">
                    {/* Left: Home Button (Conditional) or Empty Space for Balance */}
                    <div className="w-[88px]">
                        {view !== 'home' ? (
                        <button onClick={() => { setView('home'); playTone('tap'); }} className="p-3 rounded-2xl bg-white/80 dark:bg-slate-800/80 shadow-md hover:scale-105 text-slate-600 dark:text-slate-300 backdrop-blur-md transition-all duration-300">
                            <Home size={22} />
                        </button>
                        ) : (
                        <div className="w-[46px] h-[46px]"></div>
                        )}
                    </div>
                    
                    {/* Center: New ABC Logo */}
                    <div className="flex-1 flex justify-center">
                        <ABCLogo />
                    </div>
                    
                    {/* Right: Controls */}
                    <div className="flex gap-3 w-[88px] justify-end">
                        <button onClick={() => setIsDark(!isDark)} className="p-3 rounded-2xl bg-white/80 dark:bg-slate-800/80 shadow-sm hover:shadow-md text-slate-600 dark:text-slate-300 transition-all hover:scale-105 backdrop-blur-md">
                        {isDark ? <Moon size={22} /> : <Sun size={22} />}
                        </button>
                        <button onClick={() => setEnabled(!enabled)} className="p-3 rounded-2xl bg-white/80 dark:bg-slate-800/80 shadow-sm hover:shadow-md text-slate-600 dark:text-slate-300 transition-all hover:scale-105 backdrop-blur-md">
                        {enabled ? <Volume2 size={22} /> : <VolumeX size={22} />}
                        </button>
                    </div>
                    </header>

                    {/* Main Content */}
                    <main className="w-full flex-1 flex flex-col items-center justify-start p-4 relative z-10 max-w-xl mx-auto">
                    {view === 'home' && (
                        <div className="w-full space-y-8 mt-4">
                        <div className="text-center space-y-2 animate-scale-in">
                            <div className="inline-flex p-5 rounded-[2rem] bg-gradient-to-br from-indigo-500 to-purple-600 shadow-xl shadow-indigo-500/30 text-white mb-2 transform hover:scale-110 transition-transform duration-500">
                            <Sparkles size={40} fill="currentColor" className="opacity-90"/>
                            </div>
                            <h2 className="text-3xl font-black text-slate-800 dark:text-white">Ayo belajar!</h2>
                            <p className="text-slate-500 dark:text-slate-400 font-medium text-lg">pilih pelajaranmu hari ini</p>
                        </div>

                        <div className="grid gap-4 mt-8">
                            {[
                            { id: 'math', title: 'Matematika', sub: 'Berhitung Cepat', icon: <Calculator size={32}/>, color: 'from-blue-500 to-cyan-500' },
                            { id: 'reading_id', title: 'Membaca', sub: 'Bahasa Indonesia', icon: <BookOpen size={32}/>, color: 'from-emerald-500 to-teal-500' },
                            { id: 'reading_en', title: 'Reading', sub: 'Learn English', icon: <Globe size={32}/>, color: 'from-violet-500 to-fuchsia-500' }
                            ].map((item, index) => (
                            <button 
                                key={item.id}
                                onClick={() => { setView(item.id); playTone('tap'); }}
                                style={{ animationDelay: `${index * 150}ms` }}
                                className="group relative w-full p-1 rounded-[2.5rem] hover:scale-[1.02] active:scale-[0.98] transition-all duration-300 opacity-0 animate-slide-up-fade"
                            >
                                <div className={`absolute inset-0 bg-gradient-to-r ${item.color} rounded-[2.5rem] opacity-20 blur-xl group-hover:opacity-40 transition-opacity`}/>
                                <div className="relative bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 p-6 rounded-[2.3rem] flex items-center gap-6 shadow-sm hover:shadow-lg transition-shadow">
                                <div className={`w-16 h-16 rounded-3xl bg-gradient-to-br ${item.color} flex items-center justify-center text-white shadow-md group-hover:rotate-6 transition-transform duration-300`}>
                                    {item.icon}
                                </div>
                                <div className="text-left flex-1">
                                    <h3 className="text-2xl font-bold text-slate-800 dark:text-white">{item.title}</h3>
                                    <p className="text-slate-400 dark:text-slate-500 font-medium">{item.sub}</p>
                                </div>
                                <div className="w-12 h-12 rounded-full bg-slate-50 dark:bg-slate-800 flex items-center justify-center text-slate-300 group-hover:bg-slate-100 dark:group-hover:bg-slate-700 group-hover:text-slate-600 transition-colors group-hover:translate-x-1 duration-300">
                                    <ChevronRight size={24} strokeWidth={2.5}/>
                                </div>
                                </div>
                            </button>
                            ))}
                        </div>
                        </div>
                    )}

                    {view === 'math' && <MathQuizModule playTone={playTone} onBack={() => setView('home')} />}
                    {view === 'reading_id' && <ReadingQuizModule playTone={playTone} onBack={() => setView('home')} mode="id" />}
                    {view === 'reading_en' && <ReadingQuizModule playTone={playTone} onBack={() => setView('home')} mode="en" />}
                    </main>
                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
